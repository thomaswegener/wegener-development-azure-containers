grafana:
  adminPassword: "7JGX4JfzkEPP3hPVyGK7"
  service:
    type: NodePort
    nodePort: 30090
  persistence:
    enabled: true
    size: 1Gi
  initChownData:
    enabled: false
  # Sidecar disabled — dashboards imported manually via Grafana UI
  # (sidecar fails on MicroK8s self-signed cert without key usage extension)
  sidecar:
    dashboards:
      enabled: false
    datasources:
      enabled: false
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          uid: prometheus
          url: http://kube-prometheus-kube-prome-prometheus:9090
          access: proxy
          isDefault: true
        - name: Loki
          type: loki
          uid: loki
          url: http://loki:3100
          access: proxy
          isDefault: false

  grafana.ini:
    auth.proxy:
      enabled: true
      header_name: X-WEBAUTH-USER
      header_property: email
      auto_sign_up: true
      headers: "Name:X-Display-Name Role:X-WEBAUTH-ROLE"
    auth:
      disable_login_form: true

prometheus:
  prometheusSpec:
    retention: 30d
    # Also scrape pods outside kube-system so our prod namespace is covered
    podMonitorSelectorNilUsesHelmValues: false
    serviceMonitorSelectorNilUsesHelmValues: false
    additionalScrapeConfigs:
      - job_name: traefik
        static_configs:
          - targets: ['10.0.0.4:8081']
        metrics_path: /metrics

alertmanager:
  alertmanagerSpec:
    # Mount existing alertmanager config
    configSecret: ""

# node-exporter and kube-state-metrics are enabled by default — keep them
nodeExporter:
  enabled: true

kubeStateMetrics:
  enabled: true
